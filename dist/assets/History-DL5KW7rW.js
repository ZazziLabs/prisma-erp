import{c as N,r,j as e}from"./index-DkXwHJzI.js";import{h as C,i as D,L,C as S}from"./api-CP6f7Xip.js";import{C as E}from"./calendar-Edby4RUr.js";import{L as I}from"./loader-circle-ILm6hn5s.js";import{T as R}from"./trending-up-CTBTPouJ.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],T=N("chevron-down",V);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],M=N("users",F),A=()=>{const[d,a]=r.useState([]),[i,m]=r.useState(null),[u,x]=r.useState(null),[g,y]=r.useState(!1),p=r.useCallback(async()=>{try{const t=await C();a(t)}catch(t){console.error("Failed to load history",t)}},[]);r.useEffect(()=>{p()},[p]);const f=r.useCallback(async t=>{if(i===t.id){m(null),x(null);return}m(t.id),y(!0);try{const c=await D(t.date),l={};c.forEach(h=>{var o;(o=h.sale_items)==null||o.forEach(s=>{var j,b;const n=s.tour_id,_=((j=s.tours)==null?void 0:j.name)||"Produto Desconhecido",w=((b=s.tours)==null?void 0:b.icon)||"ðŸ“¦";l[n]||(l[n]={name:_,icon:w,qty_adult:0,qty_child:0,qty_native:0,totalValue:0});const q=s.qty_adult*s.unit_price_adult+s.qty_child*s.unit_price_child+s.qty_native*s.unit_price_native;l[n].qty_adult+=s.qty_adult,l[n].qty_child+=s.qty_child,l[n].qty_native+=s.qty_native,l[n].totalValue+=q})}),x({sales:c,summary:Object.values(l).sort((h,o)=>o.totalValue-h.totalValue)})}catch(c){console.error("Failed to get sales details",c),x(null)}finally{y(!1)}},[i]),v=r.useCallback(t=>new Date(t).toLocaleDateString("pt-BR",{timeZone:"UTC"}),[]),k=r.useMemo(()=>d.length===0,[d]);return e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white mb-6",children:"HistÃ³rico"}),d.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-sm transition-all overflow-hidden",children:[e.jsxs("div",{onClick:()=>f(t),className:"p-4 flex items-center justify-between group cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-700 dark:text-purple-300",children:e.jsx(E,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:v(t.date)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.sale_count," vendas"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white text-right",children:["R$ ",t.total_amount.toFixed(2)]}),i===t.id?e.jsx(T,{className:"w-5 h-5 text-gray-400"}):e.jsx(S,{className:"w-5 h-5 text-gray-400"})]})]}),i===t.id&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 border-t border-gray-100 dark:border-gray-800 animate-in fade-in duration-300",children:[g&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-4",children:[e.jsx(I,{className:"w-5 h-5 animate-spin text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"Carregando detalhes..."})]}),!g&&u&&e.jsx(B,{details:u})]})]},t.id)),k&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"Nenhum caixa fechado encontrado."})]})})},B=({details:d})=>d.sales.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Nenhuma venda registrada neste dia."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 font-medium",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:"Resumo de Produtos Vendidos"})]}),e.jsx("div",{className:"space-y-3",children:d.summary.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-700/50 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl w-10 h-10 flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-full",children:a.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold dark:text-white",children:a.name}),e.jsxs("p",{className:"text-sm font-bold text-purple-600 dark:text-purple-400",children:["R$ ",a.totalValue.toFixed(2)]})]})]})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 font-semibold mb-2",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"PÃšBLICO ATENDIDO"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[a.qty_adult>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-2 rounded-md",children:[e.jsx("p",{className:"text-sm font-bold text-blue-800 dark:text-blue-200",children:a.qty_adult}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"Adultos"})]}),a.qty_child>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 p-2 rounded-md",children:[e.jsx("p",{className:"text-sm font-bold text-green-800 dark:text-green-200",children:a.qty_child}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-300",children:"CrianÃ§as"})]}),a.qty_native>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/30 p-2 rounded-md",children:[e.jsx("p",{className:"text-sm font-bold text-amber-800 dark:text-amber-200",children:a.qty_native}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-300",children:"Nativos"})]})]})]})]},a.name))})]});export{A as History};
