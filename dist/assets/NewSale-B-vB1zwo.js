import{c as C,r,j as e,R as q}from"./index-DkXwHJzI.js";import{g as L,c as H,L as w}from"./api-CP6f7Xip.js";import{B as m}from"./Button-Ci0RQRUX.js";import{I as W,T as X,P as Y}from"./Input-BRFvc_qE.js";import{C as G}from"./circle-check-big-Bs8AOa-h.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M5 12h14",key:"1ays0h"}]],K=C("minus",J);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Q=C("package",Z);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],D=C("shopping-cart",U),ee=.01,ne=()=>{const[t,i]=r.useState([]),[l,d]=r.useState([]),[h,x]=r.useState(!1),[j,I]=r.useState(!1),[M,g]=r.useState(!1),[f,_]=r.useState("DINHEIRO"),[u,N]=r.useState(""),[p,A]=r.useState(null),R=r.useCallback(async()=>{try{const a=await L();i(a)}catch(a){console.error("Failed to load tours",a)}},[]);r.useEffect(()=>{R()},[R]);const V=r.useCallback((a,s)=>{d(o=>o.find(n=>n.tourId===a.id)?o.map(n=>n.tourId===a.id?{...n,qtyAdult:s==="adult"?n.qtyAdult+1:n.qtyAdult,qtyChild:s==="child"?n.qtyChild+1:n.qtyChild,qtyNative:s==="native"?n.qtyNative+1:n.qtyNative}:n):[...o,{tourId:a.id,tourName:a.name,tourIcon:a.icon,qtyAdult:s==="adult"?1:0,qtyChild:s==="child"?1:0,qtyNative:s==="native"?1:0,priceAdult:a.price_adult,priceChild:a.price_child,priceNative:a.price_native}])},[]),z=r.useCallback((a,s,o)=>{d(b=>{const n=[...b],P=n[a][s]+o;P>=0&&(n[a][s]=P);const k=n[a];return k.qtyAdult===0&&k.qtyChild===0&&k.qtyNative===0?n.filter((ae,B)=>B!==a):n})},[]),O=r.useCallback(a=>{d(s=>s.filter((o,b)=>b!==a))},[]),c=r.useMemo(()=>l.reduce((a,s)=>a+s.qtyAdult*s.priceAdult+s.qtyChild*s.priceChild+s.qtyNative*s.priceNative,0),[l]),v=r.useMemo(()=>l.reduce((a,s)=>a+s.qtyAdult+s.qtyChild+s.qtyNative,0),[l]),$=r.useCallback(async()=>{if(c===0)return;const a=parseFloat(u)||0,s=p?c-a:0;if(Math.abs(a+s-c)>ee){alert("A soma dos pagamentos nÃ£o bate com o total.");return}I(!0);try{await H(l,{method1:f,value1:a,method2:p||null,value2:s>0?s:null}),alert("Venda realizada com sucesso!"),d([]),x(!1),g(!1),N(""),A(null)}catch(o){console.error(o),alert("Erro ao finalizar venda.")}finally{I(!1)}},[l,c,f,u,p]),T=r.useCallback(()=>{N(c.toFixed(2)),x(!0)},[c]),S=r.useMemo(()=>{const a=parseFloat(u)||0;return Math.max(0,c-a)},[c,u]);return h?e.jsx(w,{children:e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-sm text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total a pagar"}),e.jsxs("h2",{className:"text-4xl font-bold text-purple-700 dark:text-purple-400 mt-2",children:["R$ ",c.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-sm space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Pagamento 1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("select",{value:f,onChange:a=>_(a.target.value),className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 dark:text-white",children:[e.jsx("option",{value:"DINHEIRO",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"Pix"}),e.jsx("option",{value:"DEBITO",children:"DÃ©bito"}),e.jsx("option",{value:"CREDITO",children:"CrÃ©dito"})]}),e.jsx(W,{type:"number",placeholder:"0.00",value:u,onChange:a=>N(a.target.value),autoFocus:!0})]})]}),S>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-sm space-y-4 border-l-4 border-purple-500",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Pagamento 2 (Restante)"}),e.jsxs("span",{className:"font-bold text-gray-900 dark:text-white",children:["R$ ",S.toFixed(2)]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("select",{value:p||"",onChange:a=>A(a.target.value),className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 dark:text-white w-full",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"DINHEIRO",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"Pix"}),e.jsx("option",{value:"DEBITO",children:"DÃ©bito"}),e.jsx("option",{value:"CREDITO",children:"CrÃ©dito"})]})})]}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsx(m,{fullWidth:!0,onClick:$,disabled:j,children:j?"Processando...":"Confirmar Venda"}),e.jsx(m,{fullWidth:!0,variant:"ghost",onClick:()=>x(!1),disabled:j,children:"Voltar"})]})]})}):M?e.jsx(w,{children:e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Carrinho"}),e.jsx(m,{variant:"ghost",onClick:()=>g(!1),children:"Voltar"})]}),l.length===0?e.jsxs("div",{className:"text-center py-20 opacity-50",children:[e.jsx(D,{className:"w-20 h-20 mx-auto mb-4 text-gray-300 dark:text-gray-700"}),e.jsx("p",{className:"text-lg font-medium",children:"Carrinho vazio"})]}):e.jsx("div",{className:"space-y-4 pb-32",children:l.map((a,s)=>e.jsx(F,{item:a,index:s,onUpdateQty:z,onRemove:O},s))}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-800 z-10",children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsxs(m,{fullWidth:!0,onClick:T,disabled:l.length===0,children:["Finalizar R$ ",c.toFixed(2)," ",e.jsx(G,{className:"w-5 h-5 ml-1"})]})})})]})}):e.jsxs(w,{children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Produtos"}),l.length>0&&e.jsxs("button",{onClick:()=>g(!0),className:"relative bg-purple-600 text-white p-3 rounded-full shadow-lg hover:bg-purple-700 transition-all",children:[e.jsx(D,{className:"w-6 h-6"}),e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:v})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-20 opacity-50",children:[e.jsx(Q,{className:"w-20 h-20 mx-auto mb-4 text-gray-300 dark:text-gray-700"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhum produto cadastrado"}),e.jsx("p",{className:"text-sm",children:"Cadastre produtos na aba Adicionar Pacotes"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t.map(a=>e.jsx(E,{tour:a,onAddToCart:V},a.id))})]}),l.length>0&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-10",children:e.jsxs("div",{className:"max-w-lg mx-auto bg-purple-600 text-white p-4 rounded-2xl shadow-2xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm opacity-90",children:[v," ",v===1?"item":"itens"]}),e.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",c.toFixed(2)]})]}),e.jsx(m,{variant:"secondary",onClick:()=>g(!0),children:"Ver Carrinho"})]})})]})},E=q.memo(({tour:t,onAddToCart:i})=>{const l=r.useCallback(()=>i(t,"adult"),[t,i]),d=r.useCallback(()=>i(t,"child"),[t,i]),h=r.useCallback(()=>i(t,"native"),[t,i]);return e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center lg:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-2xl flex-shrink-0",children:t.icon||"ðŸŒ´"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white leading-tight truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.type})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap lg:flex-nowrap flex-shrink-0",children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-1.5 py-2 px-3 bg-blue-50 dark:bg-blue-900/20 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-all text-sm font-medium text-blue-900 dark:text-blue-300 whitespace-nowrap",children:[e.jsx("span",{children:"ðŸ‘¨"}),e.jsx("span",{children:"Adulto"})]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 py-2 px-3 bg-green-50 dark:bg-green-900/20 rounded-full hover:bg-green-100 dark:hover:bg-green-900/30 transition-all text-sm font-medium text-green-900 dark:text-green-300 whitespace-nowrap",children:[e.jsx("span",{children:"ðŸ‘¶"}),e.jsx("span",{children:"CrianÃ§a"})]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-1.5 py-2 px-3 bg-amber-50 dark:bg-amber-900/20 rounded-full hover:bg-amber-100 dark:hover:bg-amber-900/30 transition-all text-sm font-medium text-amber-900 dark:text-amber-300 whitespace-nowrap",children:[e.jsx("span",{children:"ðŸï¸"}),e.jsx("span",{children:"Nativo"})]})]})]})})});E.displayName="ProductCard";const F=q.memo(({item:t,index:i,onUpdateQty:l,onRemove:d})=>{const h=r.useMemo(()=>t.qtyAdult*t.priceAdult+t.qtyChild*t.priceChild+t.qtyNative*t.priceNative,[t]),x=r.useCallback(()=>d(i),[i,d]);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-4 rounded-2xl shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-lg",children:t.tourIcon||"ðŸŒ´"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold dark:text-white leading-tight",children:t.tourName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Subtotal: R$ ",h.toFixed(2)]})]})]}),e.jsx("button",{onClick:x,className:"text-red-400 p-1",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 bg-gray-50 dark:bg-gray-800/50 p-3 rounded-xl",children:[t.priceAdult>0&&e.jsx(y,{label:"Adulto",price:t.priceAdult,quantity:t.qtyAdult,onDecrease:()=>l(i,"qtyAdult",-1),onIncrease:()=>l(i,"qtyAdult",1)}),t.priceChild>0&&e.jsx(y,{label:"CrianÃ§a",price:t.priceChild,quantity:t.qtyChild,onDecrease:()=>l(i,"qtyChild",-1),onIncrease:()=>l(i,"qtyChild",1)}),t.priceNative>0&&e.jsx(y,{label:"Nativo",price:t.priceNative,quantity:t.qtyNative,onDecrease:()=>l(i,"qtyNative",-1),onIncrease:()=>l(i,"qtyNative",1)})]})]})});F.displayName="CartItemCard";const y=q.memo(({label:t,price:i,quantity:l,onDecrease:d,onIncrease:h})=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm dark:text-gray-300 w-20",children:t}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",i.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:d,className:"w-8 h-8 rounded-full bg-white dark:bg-gray-700 shadow flex items-center justify-center",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-6 text-center font-medium dark:text-white",children:l}),e.jsx("button",{onClick:h,className:"w-8 h-8 rounded-full bg-white dark:bg-gray-700 shadow flex items-center justify-center",children:e.jsx(Y,{className:"w-4 h-4"})})]})]}));y.displayName="QuantityControl";export{ne as NewSale};
