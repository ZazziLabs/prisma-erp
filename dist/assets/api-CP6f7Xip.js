import{c as d,r as m,u as b,j as s,X as v,L as k,t as _,s as n}from"./index-DkXwHJzI.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],j=d("box",N);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],x=d("chart-no-axes-column",M);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],S=d("chevron-right",E);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],q=d("folder",C);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],A=d("lock",T);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],$=d("menu",D);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],P=d("moon",I);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],V=d("shopping-bag",R);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],L=d("sun",z),y=[{icon:V,label:"Nova Venda",path:"/new-sale"},{icon:j,label:"Adicionar Pacotes",path:"/tours"},{icon:x,label:"Resumo do Dia",path:"/summary"},{icon:A,label:"Fechamento",path:"/closing"},{icon:q,label:"Histórico",path:"/history"},{icon:x,label:"Relatórios",path:"/reports"}],F=({children:a})=>{const[e,t]=m.useState(!1),[o,r]=m.useState(!1),u=b(),p=m.useCallback(()=>t(i=>!i),[]),l=m.useCallback(()=>{r(i=>!i),document.documentElement.classList.toggle("dark")},[]),g=m.useCallback(()=>t(!1),[]),w=m.useMemo(()=>{const i=y.find(h=>h.path===u.pathname);return i?i.label:"Prisma ERP"},[u.pathname]);return s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 transition-colors duration-300 overflow-hidden font-sans",children:[s.jsxs("header",{className:"fixed top-0 left-0 right-0 h-16 bg-white dark:bg-gray-900 shadow-sm z-30 flex items-center px-4 justify-between",children:[s.jsx("button",{onClick:p,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800","aria-label":"Abrir menu",children:s.jsx($,{className:"w-6 h-6 text-purple-700"})}),s.jsx("h1",{className:"text-lg font-bold text-gray-800 dark:text-white tracking-tight",children:w}),s.jsx("div",{className:"w-8"})]}),e&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 backdrop-blur-sm transition-opacity",onClick:g,"aria-hidden":"true"}),s.jsxs("aside",{className:`fixed top-0 left-0 bottom-0 w-80 bg-purple-700 dark:bg-gray-900 z-50 transform transition-transform duration-300 ease-out shadow-2xl flex flex-col ${e?"translate-x-0":"-translate-x-full"}`,"aria-label":"Menu lateral",children:[s.jsxs("div",{className:"p-6 flex justify-between items-center text-white flex-shrink-0",children:[s.jsx("h2",{className:"text-2xl font-bold tracking-tighter",children:"Prisma ERP"}),s.jsx("button",{onClick:g,className:"p-1 hover:bg-white/10 rounded-full","aria-label":"Fechar menu",children:s.jsx(v,{className:"w-6 h-6"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-4 py-2",children:s.jsx("nav",{className:"space-y-2",children:y.map(i=>{const h=u.pathname===i.path;return s.jsxs(k,{to:i.path,onClick:g,className:`flex items-center gap-4 p-4 rounded-xl transition-all ${h?"bg-white text-purple-700 shadow-lg":"text-white hover:bg-white/10"}`,"aria-current":h?"page":void 0,children:[s.jsx(i.icon,{className:`w-5 h-5 ${h?"text-purple-700":"text-white/80"}`}),s.jsx("span",{className:"font-medium",children:i.label}),h&&s.jsx(S,{className:"w-4 h-4 ml-auto"})]},i.path)})})}),s.jsx("div",{className:"p-4 flex-shrink-0 border-t border-white/10",children:s.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 p-4 rounded-xl bg-purple-800/50 dark:bg-gray-800 text-white hover:bg-purple-800 dark:hover:bg-gray-700 transition-colors border border-white/10","aria-label":o?"Ativar modo claro":"Ativar modo escuro",children:[o?s.jsx(L,{className:"w-5 h-5"}):s.jsx(P,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium",children:o?"Modo Claro":"Modo Escuro"})]})})]}),s.jsx("main",{className:"pt-20 pb-24 px-4 max-w-lg mx-auto min-h-screen",children:a})]})},f={FETCH_ERROR:"Falha na conexão. Verifique sua internet e tente novamente.",401:"Acesso não autorizado. Por favor, faça login novamente.",INVALID_JWT:"Sua sessão expirou. Por favor, faça login novamente.",42501:"Você não tem permissão para realizar esta ação.",23505:"Já existe um registro com estes dados. Por favor, verifique os campos únicos.",PGRST116:"O registro que você está tentando acessar não foi encontrado."},c=(a,e)=>{var o;console.error("API Error:",a);let t="Ocorreu um erro inesperado. Tente novamente mais tarde.";if(a&&(a.code||a.message)){const r=(o=a.code)==null?void 0:o.toString();r&&f[r]?t=f[r]:f[a.message]&&(t=f[a.message])}throw _({title:"Algo deu errado!",description:t,variant:"destructive"}),a},H=async()=>{const{data:a,error:e}=await n.from("tours").select("*").eq("active",!0).order("name");return e&&c(e),a||[]},B=async a=>{const e={...a};if(e.id||delete e.id,e.id){const{data:t,error:o}=await n.from("tours").update(e).eq("id",e.id).select().single();return o&&c(o),t}else{const{data:t,error:o}=await n.from("tours").insert([e]).select().single();return o&&c(o),t}},G=async a=>{const{error:e}=await n.from("tours").update({active:!1}).eq("id",a);e&&c(e)},U=async(a,e)=>{const t=e.value1+(e.value2||0),{data:o,error:r}=await n.from("sales").insert([{total_amount:t,payment_method_1:e.method1,payment_value_1:e.value1,payment_method_2:e.method2,payment_value_2:e.value2}]).select().single();r&&c(r),o||c(new Error("Failed to create sale"));const u=a.map(l=>({sale_id:o.id,tour_id:l.tourId,qty_adult:l.qtyAdult,qty_child:l.qtyChild,qty_native:l.qtyNative,unit_price_adult:l.priceAdult,unit_price_child:l.priceChild,unit_price_native:l.priceNative})),{error:p}=await n.from("sale_items").insert(u);return p&&(await n.from("sales").delete().eq("id",o.id),c(p)),o},J=async()=>{const a=new Date().toISOString().split("T")[0],{data:e,error:t}=await n.from("sales").select("*").gte("created_at",`${a}T00:00:00`).lte("created_at",`${a}T23:59:59`).order("created_at",{ascending:!1});return t&&c(t),e||[]},Z=async a=>{const e=new Date(a);e.setUTCHours(0,0,0,0);const t=new Date(a);t.setUTCHours(23,59,59,999);const{data:o,error:r}=await n.from("sales").select("*, sale_items(*, tours(name, icon))").gte("created_at",e.toISOString()).lte("created_at",t.toISOString()).order("created_at",{ascending:!1});return r&&c(r),o||[]},W=async a=>{const{data:e,error:t}=await n.from("daily_closings").select("id").eq("date",a).maybeSingle();return t&&t.code!=="PGRST116"?(console.error("Erro ao verificar fechamento:",t),!1):!!e},X=async a=>{const{data:e,error:t}=await n.from("daily_closings").select("id").eq("date",a.date).maybeSingle();if(t&&t.code!=="PGRST116")throw console.error("Erro ao verificar fechamento:",t),new Error(`Erro ao verificar fechamento: ${t.message}`);if(e)throw new Error("O caixa para esta data já foi fechado.");const{data:o,error:r}=await n.from("daily_closings").insert([{...a}]).select().single();if(r)throw console.error("Erro ao inserir fechamento:",r),new Error(`Erro ao fechar caixa: ${r.message}`);if(!o)throw new Error("Falha ao confirmar fechamento do caixa");console.log("Caixa fechado com sucesso:",o)},K=async()=>{const{data:a,error:e}=await n.from("daily_closings").select("*").order("date",{ascending:!1});return e&&c(e),a||[]};export{j as B,S as C,F as L,J as a,W as b,U as c,G as d,X as e,A as f,H as g,K as h,Z as i,B as s};
