import{c as R,r,j as e}from"./index-DkXwHJzI.js";import{b as F,a as $,e as L,L as g,f as B}from"./api-CP6f7Xip.js";import{B as T}from"./Button-Ci0RQRUX.js";import{L as k}from"./loader-circle-ILm6hn5s.js";import{C as I}from"./circle-check-big-Bs8AOa-h.js";import{C as v}from"./clock-5wB-NO0E.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],w=R("triangle-alert",A),V=()=>{const[l,C]=r.useState([]),[S,p]=r.useState(!0),[b,u]=r.useState(!1),[c,j]=r.useState(!1),[f,y]=r.useState(!1),[i,_]=r.useState(null),[x,m]=r.useState(null),N=r.useCallback(()=>{const a=new Date,t=a.getHours(),d=new Date(a);return d.setHours(5,0,0,0),t>=5&&d.setDate(d.getDate()+1),_(d),t>=5},[]),h=r.useCallback(async()=>{try{const a=new Date().toISOString().split("T")[0],t=await F(a);j(t);const d=N();y(!t&&d)}catch(a){console.error("Failed to check day status",a)}},[N]);r.useEffect(()=>{D(),h();const a=setInterval(()=>{h()},6e4);return()=>clearInterval(a)},[h]);const D=r.useCallback(async()=>{p(!0);try{const a=await $();C(a)}catch(a){console.error("Failed to load today's sales",a),m("Erro ao carregar vendas. Tente novamente.")}finally{p(!1)}},[]),s=r.useMemo(()=>{const a={total:0,cash:0,pix:0,debit:0,credit:0};return l.forEach(t=>{a.total+=t.total_amount;const d=(o,n)=>{o==="DINHEIRO"?a.cash+=n:o==="PIX"?a.pix+=n:o==="DEBITO"?a.debit+=n:o==="CREDITO"&&(a.credit+=n)};d(t.payment_method_1,t.payment_value_1),t.payment_method_2&&t.payment_value_2&&d(t.payment_method_2,t.payment_value_2)}),a},[l]),E=r.useCallback(async()=>{if(window.confirm(`Confirma o fechamento do caixa?

Total: R$ ${s.total.toFixed(2)}
Vendas: ${l.length}

Esta a√ß√£o n√£o pode ser desfeita.`)){u(!0),m(null);try{await L({date:new Date().toISOString().split("T")[0],total_amount:s.total,total_cash:s.cash,total_pix:s.pix,total_debit:s.debit,total_credit:s.credit,sale_count:l.length}),j(!0),y(!1)}catch(t){console.error("Close day error:",t);const d=t instanceof Error?t.message:"Erro desconhecido ao fechar o caixa.";m(d),alert(`‚ùå Erro: ${d}`)}finally{u(!1)}}},[s,l.length]);return S?e.jsx(g,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center space-y-4",children:[e.jsx(k,{className:"w-12 h-12 text-purple-500 animate-spin"}),e.jsx("p",{className:"text-gray-500",children:"Carregando vendas de hoje..."})]})}):c?e.jsx(g,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center space-y-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center",children:e.jsx(I,{className:"w-16 h-16 text-green-500"})}),e.jsx("h2",{className:"text-3xl font-bold dark:text-white",children:"‚úÖ Caixa Fechado com Sucesso!"}),e.jsx("p",{className:"text-gray-500 max-w-md",children:"O movimento de hoje foi salvo no hist√≥rico com seguran√ßa."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-xl",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total fechado: ",e.jsxs("span",{className:"font-bold text-lg",children:["R$ ",s.total.toFixed(2)]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Vendas: ",e.jsx("span",{className:"font-bold",children:l.length})]})]}),i&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-900/50 p-4 rounded-xl flex items-center gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-blue-500"}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:["Pr√≥ximo fechamento dispon√≠vel: ",i.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}):e.jsx(g,{children:e.jsxs("div",{className:"space-y-6 max-w-2xl mx-auto",children:[x&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 p-4 rounded-2xl flex gap-3",children:[e.jsx(w,{className:"text-red-500 w-6 h-6 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 dark:text-red-200 mb-1",children:"Erro ao Fechar Caixa"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:x})]})]}),!f&&!x&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-900/50 p-4 rounded-2xl flex gap-3",children:[e.jsx(v,{className:"text-amber-500 w-6 h-6 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-amber-900 dark:text-amber-200 mb-1",children:c?"üîí Caixa J√° Fechado":"‚è∞ Fechamento Bloqueado"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-300",children:c?`O caixa de hoje j√° foi encerrado. Pr√≥ximo fechamento dispon√≠vel ${i?`em ${i.toLocaleDateString("pt-BR")} √†s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"amanh√£ √†s 5:00 AM"}.`:`O fechamento de caixa estar√° dispon√≠vel ${i?`em ${i.toLocaleDateString("pt-BR")} √†s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:"√†s 5:00 AM"}.`})]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 p-4 rounded-2xl flex gap-3",children:[e.jsx(w,{className:"text-red-500 w-6 h-6 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 dark:text-red-200 mb-1",children:"Aten√ß√£o!"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:"Ao fechar o caixa, voc√™ n√£o poder√° mais editar ou adicionar vendas para a data de hoje."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-purple-700 p-6 text-white",children:[e.jsx("p",{className:"text-sm font-medium opacity-90 mb-2",children:"Resumo do Dia"}),e.jsx("p",{className:"text-4xl font-bold",children:new Date().toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"p-8 text-center border-b border-gray-100 dark:border-gray-800",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Total Geral"}),e.jsxs("p",{className:"text-5xl font-bold text-gray-900 dark:text-white",children:["R$ ",s.total.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[l.length," ",l.length===1?"venda":"vendas"," realizada",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 uppercase tracking-wide",children:"Por M√©todo de Pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Dinheiro"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["R$ ",s.cash.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Pix"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["R$ ",s.pix.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"D√©bito"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["R$ ",s.debit.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Cr√©dito"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["R$ ",s.credit.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(T,{fullWidth:!0,onClick:E,disabled:b||l.length===0||!f,className:"!bg-gray-900 !text-white dark:!bg-white dark:!text-black py-4 text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5 mr-2 animate-spin"}),"Fechando Caixa..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5 mr-2"}),"Encerrar Caixa Agora"]})}),l.length===0&&e.jsxs("div",{className:"text-center p-8 bg-gray-50 dark:bg-gray-800/50 rounded-2xl",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhuma venda registrada hoje."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Adicione vendas antes de fechar o caixa."})]})]})]})})};export{V as Closing};
